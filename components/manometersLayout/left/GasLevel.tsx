import { MANOMETER_MOTION_TRANSITION, LOAD_METRIC } from "@/lib/constants";
import { useGlobalStore } from "@/stores/globalStore";
import { clamp } from "lodash";
import { motion } from "motion/react";
import { useShallow } from "zustand/shallow";

export const GasLevel = () => {
  const { loadMetric } = useGlobalStore(
    useShallow((state) => ({
      loadMetric: state.pbdMetrics[LOAD_METRIC],
    }))
  );
  const loadValue = Number(loadMetric?.raw ?? 0); // is in percentage
  const gasHeight = (clamp(loadValue, 0, 100) / 100) * 194; // no need to interpolate using getManometerHeight since it's a linear scale

  return (
    <svg
      className="absolute left-[58%] bottom-0 h-1/3"
      viewBox="0 0 82 209"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M7.5 15.1406H19.833L30.1012 62.1387H17.6058L7.5 15.1406ZM18.2509 65.1387H30.7567L40.8068 111.139H28.1421L18.2509 65.1387ZM28.7871 114.139H41.4623L51.5124 160.139H38.6783L28.7871 114.139ZM39.3234 163.139H52.1679L62 208.141H49L39.3234 163.139Z"
        fill="white"
        fillOpacity="0.2"
      />
      <mask
        id="mask0_4877_97820"
        type="alpha"
        maskUnits="userSpaceOnUse"
        x="7"
        y="15"
        width="55"
        height="194"
      >
        <motion.rect
          x="7"
          y="15"
          width="55"
          height="194"
          fill="#D9D9D9"
          animate={{ y: 194 - gasHeight }}
          transition={MANOMETER_MOTION_TRANSITION}
        />
      </mask>
      <g mask="url(#mask0_4877_97820)">
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M7.5 15.1406H19.833L30.1012 62.1387H17.6058L7.5 15.1406ZM18.2509 65.1387L28.1421 111.139H40.8068L30.7567 65.1387H18.2509ZM41.4623 114.139H28.7871L38.6783 160.139H51.5124L41.4623 114.139ZM52.1679 163.139H39.3234L49 208.141H62L52.1679 163.139Z"
          fill="url(#paint1_linear_4877_97820)"
        />
      </g>
      <path
        d="M43.5479 63.1758C42.4085 63.1758 41.5817 62.9772 41.0674 62.5801C40.5531 62.1829 40.2796 61.5286 40.2471 60.6172C40.221 60.2396 40.208 59.8815 40.208 59.543C40.208 59.1979 40.221 58.7715 40.2471 58.2637H41.5947V60.793C41.5947 61.1836 41.7477 61.4733 42.0537 61.6621C42.3597 61.8444 42.848 61.9355 43.5186 61.9355C44.762 61.9355 45.3805 61.5547 45.374 60.793C45.4456 59.7253 45.4456 58.6738 45.374 57.6387C45.348 57.2155 45.1657 56.8867 44.8271 56.6523C44.4951 56.418 43.9255 56.304 43.1182 56.3105L41.8877 56.3301L41.8193 55.0801L45.3545 50.4219H40.1787V49.1035H46.9365V50.3438L43.3428 55.0312C44.5407 55.0768 45.3968 55.3014 45.9111 55.7051C46.432 56.1087 46.7054 56.75 46.7314 57.6289C46.777 58.2604 46.7965 58.8203 46.79 59.3086C46.79 59.7969 46.7705 60.2331 46.7314 60.6172C46.6859 61.5286 46.4157 62.1829 45.9209 62.5801C45.4261 62.9772 44.6351 63.1758 43.5479 63.1758ZM49.7393 66.5254H48.3818L54.6807 49.1035H56.0381L49.7393 66.5254ZM61.8877 63.0488H60.5889V58.9473H57.0244V57.7266L59.8369 49.1035H61.8877V57.6289H63.3232V58.9473H61.8877V63.0488ZM59.4561 53.9863L58.3721 57.6289H60.5889L60.7354 53.9863L60.9014 50.4219H60.5107L59.4561 53.9863Z"
        fill="#E2DDDF"
      />
      <path
        d="M34.9824 15.5H33.625V3.04883H32.6582L32.5508 2.48242L33.8496 1.55469H34.9824V15.5Z"
        fill="#E2DDDF"
      />
      <path
        d="M52.6201 112.592H51.2627V100.141H50.2959L50.1885 99.5742L51.4873 98.6465H52.6201V112.592ZM55.3643 116.068H54.0068L60.3057 98.6465H61.6631L55.3643 116.068ZM69.29 112.592H63.1377C63.1312 112.227 63.1214 111.941 63.1084 111.732C63.1019 111.524 63.0954 111.293 63.0889 111.039C63.0889 110.785 63.0954 110.417 63.1084 109.936C63.1214 109.174 63.2451 108.536 63.4795 108.021C63.7139 107.507 64.0166 107.074 64.3877 106.723C64.7653 106.371 65.1689 106.062 65.5986 105.795L66.6143 105.199C67.1481 104.913 67.4867 104.61 67.6299 104.291C67.7796 103.965 67.8708 103.633 67.9033 103.295C67.9619 102.468 67.9619 101.645 67.9033 100.824C67.8773 100.46 67.7275 100.189 67.4541 100.014C67.1872 99.8379 66.7412 99.75 66.1162 99.75C65.5238 99.75 65.0973 99.8379 64.8369 100.014C64.583 100.189 64.4463 100.46 64.4268 100.824C64.4137 101.28 64.4072 101.736 64.4072 102.191C64.4137 102.647 64.4333 103.106 64.4658 103.568H63.1084C63.0889 103.126 63.0726 102.683 63.0596 102.24C63.0465 101.791 63.0498 101.397 63.0693 101.059C63.1149 100.147 63.3753 99.4961 63.8506 99.1055C64.3258 98.7148 65.0908 98.5195 66.1455 98.5195C67.2523 98.5195 68.0368 98.7148 68.499 99.1055C68.9678 99.4961 69.2249 100.147 69.2705 101.059C69.2965 101.378 69.3096 101.755 69.3096 102.191C69.3096 102.621 69.2965 102.986 69.2705 103.285C69.2054 104.105 68.9938 104.76 68.6357 105.248C68.2842 105.73 67.7471 106.173 67.0244 106.576L65.9697 107.201C65.4749 107.462 65.1038 107.846 64.8564 108.354C64.6156 108.855 64.4951 109.382 64.4951 109.936V111.273H69.29V112.592Z"
        fill="#E2DDDF"
      />
      <path
        d="M63.3652 160.537H62.0078V148.086H61.041L60.9336 147.52L62.2324 146.592H63.3652V160.537ZM66.1094 164.014H64.752L71.0508 146.592H72.4082L66.1094 164.014ZM78.2578 160.537H76.959V156.436H73.3945V155.215L76.207 146.592H78.2578V155.117H79.6934V156.436H78.2578V160.537ZM75.8262 151.475L74.7422 155.117H76.959L77.1055 151.475L77.2715 147.91H76.8809L75.8262 151.475Z"
        fill="#E2DDDF"
      />
      <path
        d="M77.9736 208.627C76.8799 208.627 76.0433 208.409 75.4639 207.973C74.8844 207.53 74.5915 206.905 74.585 206.098C74.5589 204.62 74.5459 203.096 74.5459 201.527C74.5459 199.952 74.5589 198.428 74.585 196.957C74.5915 196.137 74.8844 195.512 75.4639 195.082C76.0433 194.646 76.8799 194.428 77.9736 194.428C79.0479 194.428 79.8747 194.646 80.4541 195.082C81.04 195.512 81.3395 196.137 81.3525 196.957C81.4046 198.428 81.4307 199.955 81.4307 201.537C81.4307 203.113 81.4046 204.633 81.3525 206.098C81.3395 206.905 81.04 207.53 80.4541 207.973C79.8747 208.409 79.0479 208.627 77.9736 208.627ZM77.9736 207.387C79.3018 207.387 79.9756 207.038 79.9951 206.342C80.0602 204.623 80.0895 202.934 80.083 201.273C80.0765 199.607 80.0472 198.087 79.9951 196.713C79.9561 196.01 79.2822 195.658 77.9736 195.658C77.3421 195.658 76.8473 195.749 76.4893 195.932C76.1377 196.107 75.9554 196.368 75.9424 196.713C75.8968 198.393 75.874 200.062 75.874 201.723C75.874 203.383 75.8968 204.923 75.9424 206.342C75.9554 206.68 76.1377 206.941 76.4893 207.123C76.8473 207.299 77.3421 207.387 77.9736 207.387Z"
        fill="#E2DDDF"
      />
      <path d="M8.5 39H5L41 208.141H44.5L8.5 39Z" fill="#F4F4F5" />
      <path d="M3.49996 15H0L4.41117 36.7763H8L3.49996 15Z" fill="#EF4444" />
      <defs>
        <linearGradient
          id="paint1_linear_4877_97820"
          x1="-54.2111"
          y1="76.4993"
          x2="15.0281"
          y2="234.604"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#E8E1E2" />
          <stop offset="1" stopColor="#2784FE" />
        </linearGradient>
      </defs>
    </svg>
  );
};
